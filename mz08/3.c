/*
Задача mz08-3: fork-3
На стандартном потоке ввода вводятся три строки текста, каждая из которых содержит целое 32-битное знаковое число. Длина каждой строки — ровно 8 символов с учетом завершающего символа \n.

Процесс-отец создает трех сыновей, которые работают параллельно друг другу. Сыновья получают порядковые номера 1, 2, 3. Каждый процесс обрабатывет одну из строк входных данных. Каждый процесс выводит на стандартный поток вывода свой порядковый номер и квадрат числа, считанного из входной строки.

Обработка заключается в чтении значения из файла, вычислении значения и выводе результата. Стандартный поток ввода не является файлом произвольного доступа (является каналом). Результат возведения в квадрат представим 32-битным знаковым типом.

Каждый результат должен быть записан на отдельной строке. Порядок вывода строк значения не имеет.

Для вывода использовать средства высокого уровня.

Процесс-родитель должен завершаться самым последним из всех процессов.
*/
#include <stdio.h>
#include <unistd.h>
#include <sys/wait.h>
#include <stdlib.h>

enum
{
    BUF_SIZE = 9,
    ITERATIONS = 3
};

int main(int argc, char **argv) {
    for (int i = 1; i <= ITERATIONS; i++) {
        int pid = fork();

        if (pid < 0) {
            exit(1);
        } else if (!pid) {
            char buf[BUF_SIZE];
            read(0, buf, sizeof(buf) - 1);

            buf[sizeof(buf) - 1] = '\0';

            int num;
            sscanf(buf, "%d", &num);

            printf("%d %d\n", i, num * num);
            fflush(stdout);

            exit(0);
        }
    }

    for (int i = 0; i < ITERATIONS; ++i) {
        int st;
        wait(&st);

        if (!(WIFEXITED(st) && !WEXITSTATUS(st))) {
            return 1;
        }
    }

    return 0;
}
